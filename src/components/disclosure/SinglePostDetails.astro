---
import { Icon } from 'astro-icon/components';

import Image from '~/components/common/Image.astro';
import PostTags from '~/components/disclosure/Tags.astro';
import SocialShare from '~/components/common/SocialShare.astro';
import { getDisclosurePermalink } from '~/utils/permalinks';
import { getFormattedDate } from '~/utils/utils';
import { getFormattedDateWithLongMonth } from '~/utils/utils';
import { getBlogPosts } from '~/utils/patent';
import { getRelatedPosts } from '~/utils/disclosure';
import {getRelatedDisclosurePosts, getRelatedDisclosurePostsByAuthors} from '~/utils/disclosure';
import type { Post } from '~/types';
//Import the patent urls json file
import patenturl from '../../../support/patenturls.json';

export interface Props {
  post: Post;
  url: string | URL;
}

const { post, url } = Astro.props;
const { Content } = post;

// Get the related posts
const relatedPosts = await getRelatedPosts(post.patentId)
// Get the latest 4 blogs
// const blogPosts = await getBlogPosts()
const relatedPostsD = post.tags ? await getRelatedDisclosurePosts(post) : [];
const relatedPostsA = post.disclosureAuthors ? await getRelatedDisclosurePostsByAuthors(post) : [];
---
<div class="container mx-auto flex flex-wrap py-8 px-4 bg-gray-50 dark:bg-gray-900 min-h-screen">
  <!-- Scholarly Header with Academic Styling -->
  <div class="w-full mb-4">
    <div class="bg-white dark:bg-gray-800 rounded-sm border border-gray-300 dark:border-gray-600 p-8 shadow-sm">
      <!-- Updated Header Section - Move Publication ID near title -->
      <div class="border-b border-gray-200 dark:border-gray-700 pb-6 mb-6">
        <div class="flex flex-wrap items-start justify-between">
          <div class="flex items-center mb-4 md:mb-0">
            <div class="bg-gray-700 dark:bg-gray-600 p-3 rounded-sm mr-4">
              <Icon name="tabler:file-certificate" class="w-8 h-8 text-white" />
            </div>
            <div>
              <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-1 font-serif">Intellectual Frontiers Journal of Open Innovation in Healthtech</h2>
              <p class="text-sm text-gray-600 dark:text-gray-400 font-medium">
                A Prior Art Warehouse for AI, Medtech, and Digital Therapeutics
              </p>
            </div>
          </div>
          <div class="text-left md:text-right w-full md:w-auto">
            {post.language && (
              <div class="text-sm text-gray-700 dark:text-gray-300 mb-1">
                <span class="font-semibold">Language:</span> {post.language}
              </div>
            )}
            <div class="text-sm text-gray-700 dark:text-gray-300 mb-1">
              <span class="font-semibold">Status:</span> 
              <span class="ml-1 px-2 py-1 bg-green-50 dark:bg-green-900/30 text-green-800 dark:text-green-200 text-xs font-medium rounded-sm border border-green-200 dark:border-green-700">
                {post.disclosureStatus}
              </span>
            </div>
            <div class="text-sm text-gray-700 dark:text-gray-300">
              <span class="font-semibold">Original Publication Date:</span> {getFormattedDateWithLongMonth(post.publishDate)}
            </div>
            <div class="text-sm text-gray-700 dark:text-gray-300">
              <span class="font-semibold">IFJ Number:</span><span class="font-bold"> {post.disclosureId}</span>
            </div>
          </div>
        </div>
      </div>
      <div class="text-center mb-6">
        <!-- <div class="mb-3">
          <span class="inline-flex items-center px-4 py-2 bg-gray-800 dark:bg-gray-700 text-white text-lg font-bold rounded-sm border border-gray-600 font-mono"> -->
            <!-- <Icon name="tabler:hash" class="w-5 h-5 mr-2" /> -->
            <!-- IFJ Number: 
            {post.disclosureId}
          </span>
        </div> -->
        <h1 class="text-3xl md:text-4xl font-bold leading-tight tracking-normal font-serif text-gray-900 dark:text-white">
          {post.title}
        </h1>
      </div>
      
      {post.disclosureAuthors && Array.isArray(post.disclosureAuthors) && post.disclosureAuthors.length > 0 && (
  <div class="text-center border-t border-gray-200 dark:border-gray-700 pt-4">
    <div class="max-w-2xl mx-auto">
      <p class="text-sm text-gray-600 dark:text-gray-400 font-medium mb-2 tracking-wide">
        {post.disclosureAuthors.length === 1 ? 'Author' : 'Authors'}
      </p>
      <p class="text-lg text-gray-600 dark:text-gray-200 font-serif leading-relaxed italic">
        {post.disclosureAuthors.join(' â€¢ ')}<span class="text-sm text-gray-500">, Netspective Communications LLC</span>
      </p>
    </div>
  </div>
)}
    </div>
  </div>
<!-- Right after the authors section and before the main content -->
{post.aiSummary && (
  <div class="w-full mb-6">
    <div class="bg-white dark:bg-gray-800 rounded-sm border-l-4 border-l-gray-300 dark:border-gray-500 border border-gray-200 dark:borsder-gray-600 p-6 shadow-sm">
      <div class="flex items-start mb-4">
        <div class="bg-gray-100 dark:bg-gray-700 p-2 rounded-sm mr-4 mt-1">
          <Icon name="tabler:file-description" class="w-5 h-5 text-gray-600 dark:text-gray-400" />
        </div>
        <div>
          <h3 class="tesxt-lg font-medium text-gray-900 dark:text-white tracking-wide uppercase text-md mb-1 font-sans">
            Technical Overview
          </h3>
          <div class="w-12 h-0.5 bg-gray-400 dark:bg-gray-500"></div>
        </div>
      </div>
      <div class="ml-13">
        <p class="text-gray-700 dark:text-gray-300 leading-relaxed text-base font-serif italic">
          {post.aiSummary}
        </p>
      </div>
    </div>
  </div>
)}




  <!-- Academic Back to Top Button -->
  <button
    id="to-top-button"
    onclick="goToTop()"
    title="Go To Top"
    class="hidden fixed z-50 bottom-10 right-10 p-4 border border-gray-400 dark:border-gray-600 w-14 h-14 rounded-sm shadow-lg bg-gray-800 hover:bg-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600 text-white text-lg font-semibold transition-all duration-300 hover:scale-105"
  >
    <Icon name="tabler:arrow-up" class="w-6 h-6" />
    <span class="sr-only">Go to top</span>
  </button>

  <!-- All Scripts -->
  <script>
    var toTopButton = document.getElementById('to-top-button');
    if (toTopButton) {
      window.onscroll = function () {
        if (document.body.scrollTop > 500 || document.documentElement.scrollTop > 500) {
          toTopButton.classList.remove('hidden');
        } else {
          toTopButton.classList.add('hidden');
        }
      };
      window.goToTop = function () {
        window.scrollTo({
          top: 0,
          behavior: 'smooth',
        });
      };
    }
  </script>

  <script>
    var images = document.querySelectorAll('.patentimages img');
    var currentIndex = 0;
    
    images.forEach(function(img, index) {
      img.addEventListener('click', function() {
        showModal(img.src, index);
      });
    });

    var modal = document.getElementById('patentimagemodal');
    var modalImg = document.getElementById('modal-img');
    var closeModalBtn = document.getElementById('close-modal');
    var prevBtn = document.getElementById('prev-btn');
    var nextBtn = document.getElementById('next-btn');

    function showModal(src, index) {
      modal.style.display = 'flex';
      modalImg.src = src;
      currentIndex = index;
      updatePrevNextButtons();
    }
    
    closeModalBtn.addEventListener('click', function() {
      modal.style.display = 'none';
    });

    function prevImage() {
      if (currentIndex > 0) {
        currentIndex--;
        modalImg.src = images[currentIndex].src;
        updatePrevNextButtons();
      }
    }
    
    function nextImage() {
      if (currentIndex < images.length - 1) {
        currentIndex++;
        modalImg.src = images[currentIndex].src;
        updatePrevNextButtons();
      }
    }
    
    function updatePrevNextButtons() {
      prevBtn.disabled = currentIndex === 0;
      nextBtn.disabled = currentIndex === images.length - 1;
    }
  
    prevBtn.addEventListener('click', function() {
      prevImage();
    });
    nextBtn.addEventListener('click', function() {
      nextImage();
    });
  </script>
  
</div>
